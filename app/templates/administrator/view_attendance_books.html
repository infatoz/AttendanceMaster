{% extends "administrator/base.html" %} 
{% block title %} View All Attendance Books {% endblock title %} 
{% block content %}
<div class="pagetitle">
  <h1>View All Attendance Books</h1>
  <nav>
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{% url 'view_attendance_books' %}">Attendance Books</a></li>
      <li class="breadcrumb-item">View All Attendance Books</li>
    </ol>
  </nav>
</div>
<!-- End Page Title -->

<section class="section mb-3">
  <div class="btn-group" role="group" aria-label="Menu">
    <a
      role="button"
      class="btn btn-outline-primary btn-sm"
      href="{% url 'view_attendance_books' %}"
      ><i class="bi bi-eye"></i> View</a
    >
    <a
      role="button"
      class="btn btn-outline-primary btn-sm"
      href="{% url 'add_attendance_book' %}"
      ><i class="bi bi-plus"></i> Add</a
    >
  </div>
</section>

<section class="section">
  <div class="row">
    <div class="col-lg-12">
      {% if messages %}
      <ul class="messages">
        {% for message in messages %} 
        {% if message.tags == 'success' %}
        <div
          class="alert alert-success alert-dismissible fade show"
          role="alert"
        >
          <i class="bi bi-check-circle me-1"></i>
          {{message}}
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="alert"
            aria-label="Close"
          ></button>
        </div>
        {% endif %} 
        {% if message.tags == 'error' %}
        <div
          class="alert alert-danger alert-dismissible fade show"
          role="alert"
        >
          <i class="bi bi-exclamation-octagon me-1"></i>
          {{message}}
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="alert"
            aria-label="Close"
          ></button>
        </div>
        {% endif %} 
        {% endfor %}
      </ul>
      {% endif %}

      <div class="card">
        <div class="card-body">
          <h5 class="card-title">All Attendance Books</h5>

          <table
          style="width: 100%;"
            id="attendanceBooksTable"
            class="table table-bordered display wrap"
          >
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Book Code</th>
                <th>Book Type</th>
                <!-- <th>Created At</th> -->
                <th>Teachers</th>
                <th>Students Count</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for book in attendance_books %}
              <tr>
                <td>{{ book.id }}</td>
                <td>{{ book.name }}</td>
                <td>{{ book.book_code }}</td>
                <!-- <td>{{ book.book_type }}</td> -->
                <td>{{ book.get_book_type_display }}</td>
                <!-- <td>{{ book.created_at }}</td> -->
                <td>
                  <ul>
                    {% for teacher in book.teachers.all %}
                    <li>{{ teacher.user.fullname }} - [{{ teacher.user.userid }}]</li>
                    {% endfor %}
                  </ul>
                </td>
                <td>
                  {{ book.students.count }}
                </td>
                <td>
                  <div class="btn-group" role="group" aria-label="Menu">
                  <a href="{% url 'mark_attendance' book.id  %}" class="btn btn-sm btn-outline-primary" role="button"><i class="bi bi-check-circle me-2"></i>Mark Attendance</a>
                  <a href="{% url 'view_attendance_records' book.id%}" class="btn btn-sm btn-outline-secondary" role="button"><i class="bi bi-eye me-2"></i>View Attendance</a>
                  <!-- <a href="{% url 'view_attendance_records' book.id%}" class="btn btn-sm btn-outline-warning" role="button"><i class="bi bi-pencil me-2"></i>Edit</a> -->
                  <a href="{% url 'delete_attendance_book' book.id%}" class="btn btn-sm btn-outline-danger" role="button"><i class="bi bi-trash me-2"></i>Delete</a>
                </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  $(document).ready(function () {
    $('#attendanceBooksTable').DataTable({
      pageLength: 150,
      lengthMenu: [150,500, 1000, 1500, 2000, 2500, 3000,4000,5000],
      order: [[0, "desc"]],
      paging: true,
      scrollCollapse: false,
        scrollX: true,
        scrollY: false,
    })
  });
</script>

{% endblock content %}
