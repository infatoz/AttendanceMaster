{% extends "administrator/base.html" %}
{% load custom_filters %}
{% block title %} Edit Student {% endblock title %}
{% block content %}
<div class="pagetitle">
    <h1>Edit Student</h1>
    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="#">Students</a></li>
        <li class="breadcrumb-item">Edit Student</li>
      </ol>
    </nav>
  </div><!-- End Page Title -->

  <section class="section">
    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
              {% if message.tags == 'success' %}
              <div class="alert alert-success alert-dismissible fade show" role="alert">
                <i class="bi bi-check-circle me-1"></i>
                {{message}}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
              {% endif %}
              {% if message.tags == 'error' %}
              <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <i class="bi bi-exclamation-octagon me-1"></i>
                  {{message}}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
              {% endif %}
            {% endfor %}
        </ul>
    {% endif %}

    

    <form method="POST">
        {% csrf_token %}
        <h2>Mark Attendance for {{ attendance_book.name }}</h2>
        <label for="date">Date:</label>
        <input type="date" name="date" id="dateInput" required>
        <label for="session">Session:</label>
        <select name="session" id="session" required>
          <option value="1">Class 1</option>
          <option value="2">Class 2</option>
          <option value="3">Class 3</option>
          <option value="4">Class 4</option>
          <option value="5">Class 5</option>
          <option value="6">Class 6</option>
          <option value="7">Class 7</option>
          <option value="8">Class 8</option>
        </select>

        <table class="table table-bordered datatable">
          <thead>
              <tr>
                  <th>Student Name</th>
                  {% for date, sessions in records_by_date_session.items %}
                      {% for session in sessions %}
                          <th>{{ date }} (Session {{ session }})</th>
                      {% endfor %}
                  {% endfor %}
                  <th>Total Count</th>
                  <th>Attendance %</th>
                  <th>Mark Attendance</th>
              </tr>
          </thead>
          <tbody>
              {% for student in students %}
                  <tr>
                      <td>{{ student.user.fullname }}</td>
                      {% for date, sessions in records_by_date_session.items %}
                          {% for session, records in sessions.items %}
                              <td>{{ records|get_item:student.user.userid }}</td>
                          {% endfor %}
                      {% endfor %}
                      <td>{{ student_attendance|get_item:student.user.userid|get_item:'count' }}</td>
                      <td>{{ student_attendance|get_item:student.user.userid|get_item:'percentage' }}%</td>
                      <td><input type="checkbox" name="attendance" value="{{ student.user.userid }}" checked></td>
                  </tr>
              {% endfor %}
          </tbody>
      </table>
    
        <!-- <table class="table datatable">
            <thead>
                <tr>
                    <th>Student Name</th>
                    {% for record in attendance_records %}
                        <th>{{ record.date }}</th>
                    {% endfor %}
                    <th>Mark Attendance</th>
                </tr>
            </thead>
            <tbody>
                {% for student in students %}
                    <tr>
                        <td>{{ student.user.fullname }}</td>
                        {% for record in attendance_records %}
                            <td>
                                {% if record.student == student %}
                                    {{ record.get_status_display }}
                                {% endif %}
                            </td>
                        {% endfor %}
                        <td>
                            <input type="checkbox" name="attendance" value="{{ student.user.userid }}" checked>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table> -->

        
    
        <button type="submit">Submit</button>
    </form>

    <script>
    // Get today's date in YYYY-MM-DD format
    const today = new Date().toISOString().split('T')[0];

    // Get yesterday's date in YYYY-MM-DD format
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    const yesterdayFormatted = yesterday.toISOString().split('T')[0];

    // Set the min and max attributes to yesterday and today
    const dateInput = document.getElementById('dateInput');
    dateInput.setAttribute('min', yesterdayFormatted);
    dateInput.setAttribute('max', today);
</script>
    
  </section>
{% endblock content %}